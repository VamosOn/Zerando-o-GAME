<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tabela de Metas â€” Compacta Responsiva</title>

<style>
  :root{
    --bg:#f2f2f2;
    --card:#fff;
    --accent:#0066cc;
    --muted:#666;
    --c1:#ffe28a;
    --c2:#ffb3b3;
    --c3:#ffd9b3;
    --c4:#d6f5d6;
    --c5:#cce6ff;
    --done:#b4ffb4;
  }

  body{
    font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,Arial;
    background:var(--bg);
    margin:0;
    padding:18px;
  }

  .top-bar{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    margin-bottom:10px;
  }

  label{
    font-size:14px;
    color:var(--muted);
  }

  input[type=number]{
    padding:6px;
    width:90px;
    text-align:center;
    border:1px solid #ccc;
    border-radius:6px;
  }

  button{
    background:var(--accent);
    color:#fff;
    border:none;
    padding:8px 12px;
    border-radius:8px;
    cursor:pointer;
  }

  #conteudo{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
    gap:14px;
  }

  .quadro{
    background:var(--card);
    border-radius:10px;
    padding:10px;
    box-shadow:0 2px 6px rgba(0,0,0,0.06);
    transition:0.25s;
  }

  .titulo{
    font-weight:700;
    margin-bottom:8px;
    display:flex;
    justify-content:space-between;
    align-items:center;
  }

  table{
    width:100%;
    border-collapse:collapse;
  }

  th,td{
    padding:6px;
    border-bottom:1px solid #eee;
    text-align:center;
    font-size:14px;
  }

  tbody tr:nth-child(1){background:var(--c1);}
  tbody tr:nth-child(2){background:var(--c2);}
  tbody tr:nth-child(3){background:var(--c4);}

  .feito-btn{
    background:#22aa22;
    padding:4px 10px;
    font-size:12px;
    border-radius:6px;
    cursor:pointer;
  }

  .feito{
    background:var(--done)!important;
  }

  /* NOVO: total arrecadado */
  #totalFinal{
    font-size:18px;
    font-weight:700;
    text-align:right;
    margin-bottom:15px;
    color:#333;
  }
</style>
</head>

<body>

<h2>META Ã‰ TUDO ðŸ“ŠðŸ’°âŒ›</h2>

<!-- NOVO: total Ã  direita -->
<div id="totalFinal">Total arrecadado: R$ 0,00</div>

<div class="top-bar">
  <label>Valor Inicial
    <input id="valorInicial" type="number" step="0.01" oninput="salvarLS()">
  </label>

  <label>Odd
    <input id="oddGlobal" type="number" step="0.01" oninput="salvarLS()">
  </label>

  <label>Quadros
    <input id="qtdQuadros" type="number" min="1" max="100" value="10" oninput="salvarLS()">
  </label>
</div>

<div class="top-bar" style="justify-content:center;">
  <button onclick="gerar()">Gerar</button>
  <button onclick="adicionarQuadro()">+Q</button>
  <button onclick="removerQuadro()">-Q</button>
</div>

<div id="conteudo"></div>

<script>

function gerarID(q){ return "quadro_" + q; }

// -------------------- LOCALSTORAGE ----------------------

function salvarLS(){
  const feitos = {};

  document.querySelectorAll(".quadro").forEach((q,i)=>{
    const id = gerarID(i+1);
    feitos[id] = q.classList.contains("feito");
  });

  const data = {
    valorInicial: document.getElementById("valorInicial").value,
    oddGlobal: document.getElementById("oddGlobal").value,
    qtdQuadros: document.getElementById("qtdQuadros").value,
    feitos,
    totalFinal: document.getElementById("totalFinal").innerText
  };

  localStorage.setItem("tabelaMeta", JSON.stringify(data));
}

function carregarLS(){
  const data = JSON.parse(localStorage.getItem("tabelaMeta"));
  if(!data) return;

  document.getElementById("valorInicial").value = data.valorInicial;
  document.getElementById("oddGlobal").value = data.oddGlobal;
  document.getElementById("qtdQuadros").value = data.qtdQuadros;

  gerar(false);

  const quadros = document.querySelectorAll(".quadro");
  quadros.forEach((q,i)=>{
    const id = gerarID(i+1);
    if(data.feitos[id]){
      q.classList.add("feito");
    }
  });

  if(data.totalFinal)
    document.getElementById("totalFinal").innerText = data.totalFinal;
}

// ---------------- GERAR TABELA -------------------------

let quadros = 10;

function gerar(deveSalvar=true){
    let inicio = parseFloat(document.getElementById("valorInicial").value)||0;
    let odd = parseFloat(document.getElementById("oddGlobal").value)||1;
    quadros = parseInt(document.getElementById("qtdQuadros").value)||10;

    let conteudo = document.getElementById("conteudo");
    conteudo.innerHTML="";
    if(inicio===0) return;

    let entradaInicial = inicio;

    let totalArrecadado = 0; // NOVO

    for(let q=1; q<=quadros; q++){
        let e1 = entradaInicial;
        let r1 = e1 * odd;
        let e2 = r1;
        let r2 = e2 * odd;
        let e3 = r2;
        let r3 = e3 * odd;

        entradaInicial = r3 - e1;

        totalArrecadado += e1; // NOVO (somando primeira entrada)

        conteudo.innerHTML += `
        <div class='quadro' data-id="${gerarID(q)}">
          <div class='titulo'>
            Quadro ${q}
            <button class="feito-btn" onclick="marcarFeito(this)">Feito</button>
          </div>

          <table>
            <tr><th>Entrada</th><th>Odd</th><th>Retorno</th></tr>
            <tr><td>${e1.toFixed(2)}</td><td>${odd.toFixed(2)}</td><td>${r1.toFixed(2)}</td></tr>
            <tr><td>${e2.toFixed(2)}</td><td>${odd.toFixed(2)}</td><td>${r2.toFixed(2)}</td></tr>
            <tr><td>${e3.toFixed(2)}</td><td>${odd.toFixed(2)}</td><td>${r3.toFixed(2)}</td></tr>
          </table>
        </div>`;

        if(entradaInicial <= 0) break;
    }

    // atualizar topo
    document.getElementById("totalFinal").innerText =
        "TotalðŸ¤‘ðŸ’²: R$ " + totalArrecadado.toFixed(2);

    if(deveSalvar) salvarLS();
}

// ---------------- MARCAR FEITO -------------------------

function marcarFeito(btn){
  const quadro = btn.closest(".quadro");
  quadro.classList.toggle("feito");
  salvarLS();
}

// ---------------- QUADROS + / - -----------------------

function adicionarQuadro(){
  quadros++;
  document.getElementById("qtdQuadros").value = quadros; 
  gerar();
}

function removerQuadro(){
  if(quadros>1){ 
    quadros--; 
    document.getElementById("qtdQuadros").value = quadros; 
    gerar(); 
  }
}

// -------------------- START --------------------------

window.onload = ()=>carregarLS();

</script>
</body>
</html>
